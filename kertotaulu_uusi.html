<!DOCTYPE html>
<html lang="fi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>matikkamato</title>
    <link rel="stylesheet" href="style.css">
    <link rel="icon" type="image/x-icon" href="mato.svg">
</head>

<body>
    <h1><a id="otsikko" href="index.html"><img src="mato.svg" alt="matikkamato" style="width:10%;height:10%;">matikkamato</a></h1>
    <h2>Kertotaulut</h2>

    <p>Valitse kertotaulu(t):</p>
    <select id="table-selection" multiple size="6" onchange="nextQuestion()">
        <option value="0">Satunnainen (1–10)</option>
        <option value="2">2</option>
        <option value="3">3</option>
        <option value="4">4</option>
        <option value="5">5</option>
        <option value="6">6</option>
        <option value="7">7</option>
        <option value="8">8</option>
        <option value="9">9</option>
        <option value="10">10</option>
    </select>
    <br>
    <button type="button" onclick="selectAllTables()">Valitse kaikki</button>
    <button type="button" onclick="clearAllTables()">Tyhjennä valinta</button>

    <p>Valitse pelimuoto:
        <select id="mode-selection" onchange="nextQuestion()">
            <option value="multi">Monivalinta</option>
            <option value="input">Tekstikenttä</option>
        </select>
    </p>

    <div id="game-container">
        <p id="question"></p>
        <div id="answer-buttons"></div>
        <p id="result"></p>
        <p>Oikeat vastaukset: <span id="correct">0</span></p>
        <p>Väärät vastaukset: <span id="incorrect">0</span></p>
        <button onclick="nextQuestion()">Seuraava</button>
    </div>

    <script>
        let correctAnswers = 0;
        let incorrectAnswers = 0;
        let num1, num2, correctAnswer;

        // Hae valitut kertotaulut
        function getSelectedTables() {
            const select = document.getElementById("table-selection");
            const values = Array.from(select.selectedOptions).map(opt => parseInt(opt.value));
            return values;
        }

        // Luo uusi kysymys
        function generateQuestion() {
            const selectedTables = getSelectedTables();

            if (selectedTables.length === 0) {
                // Jos mitään ei valittu → satunnainen 1–10
                num2 = Math.floor(Math.random() * 10) + 1;
            } else if (selectedTables.includes(0)) {
                // Jos mukana "Satunnainen"
                num2 = Math.floor(Math.random() * 10) + 1;
            } else {
                // Valitaan satunnainen käyttäjän valitsemista
                num2 = selectedTables[Math.floor(Math.random() * selectedTables.length)];
            }

            num1 = Math.floor(Math.random() * 10) + 1;
            correctAnswer = num1 * num2;

            document.getElementById("question").textContent = `${num1} ∙ ${num2} =`;
            generateAnswerOptions();
        }

        // Luo vastausvaihtoehdot
        function generateAnswerOptions() {
            const answerButtonsDiv = document.getElementById("answer-buttons");
            answerButtonsDiv.innerHTML = '';
            const mode = document.getElementById("mode-selection").value;

            if (mode === "multi") {
                const selectedTables = getSelectedTables();
                const answers = [correctAnswer];
                while (answers.length < 4) {
                    const wrongNum = Math.floor(Math.random() * 10) + 1;
                    let wrongAnswer;
                    if (selectedTables.length === 0 || selectedTables.includes(0)) {
                        wrongAnswer = (Math.floor(Math.random() * 10) + 1) * wrongNum;
                    } else {
                        const randomTable = selectedTables[Math.floor(Math.random() * selectedTables.length)];
                        wrongAnswer = randomTable * wrongNum;
                    }
                    if (!answers.includes(wrongAnswer)) {
                        answers.push(wrongAnswer);
                    }
                }

                answers.sort(() => Math.random() - 0.5);

                answers.forEach(answer => {
                    const button = document.createElement("button");
                    button.textContent = answer;
                    button.className = "answer-button";
                    button.onclick = () => checkAnswer(button, answer);
                    answerButtonsDiv.appendChild(button);
                });

            } else if (mode === "input") {
                const input = document.createElement("input");
                input.type = "number";
                input.id = "user-answer";
                input.placeholder = "Kirjoita vastaus";

                const button = document.createElement("button");
                button.textContent = "Vastaa";
                button.onclick = () => {
                    const value = parseInt(document.getElementById("user-answer").value);
                    checkTextAnswer(value);
                };

                answerButtonsDiv.appendChild(input);
                answerButtonsDiv.appendChild(button);

                // Enterin painallus toimii vastauksena
                input.addEventListener("keydown", function(event) {
                    if (event.key === "Enter") {
                        const value = parseInt(input.value);
                        checkTextAnswer(value);
                    }
                });
            }
        }

        // Tarkista monivalintavastaus
        function checkAnswer(button, selectedAnswer) {
            const buttons = document.querySelectorAll(".answer-button");
            buttons.forEach(btn => btn.onclick = null);

            if (selectedAnswer === correctAnswer) {
                correctAnswers++;
                document.getElementById("result").textContent = "Oikein!";
                document.getElementById("correct").textContent = correctAnswers;
                button.classList.add("correct");
            } else {
                incorrectAnswers++;
                document.getElementById("result").textContent = `Väärin! Oikea vastaus on ${correctAnswer}.`;
                document.getElementById("incorrect").textContent = incorrectAnswers;
                button.classList.add("incorrect");
                buttons.forEach(btn => {
                    if (parseInt(btn.textContent) === correctAnswer) {
                        btn.classList.add("correct");
                    }
                });
            }
        }

        // Tarkista tekstikenttävastaus
        function checkTextAnswer(value) {
            if (value === correctAnswer) {
                correctAnswers++;
                document.getElementById("result").textContent = "Oikein!";
                document.getElementById("correct").textContent = correctAnswers;
            } else {
                incorrectAnswers++;
                document.getElementById("result").textContent = `Väärin! Oikea vastaus on ${correctAnswer}.`;
                document.getElementById("incorrect").textContent = incorrectAnswers;
            }
        }

        // Siirry seuraavaan kysymykseen
        function nextQuestion() {
            generateQuestion();
            document.getElementById("result").textContent = '';
        }

        // Valitse kaikki taulut (2–10)
        function selectAllTables() {
            const select = document.getElementById("table-selection");
            for (let i = 0; i < select.options.length; i++) {
                if (select.options[i].value !== "0") {
                    select.options[i].selected = true;
                }
            }
            nextQuestion();
        }

        // Tyhjennä kaikki valinnat
        function clearAllTables() {
            const select = document.getElementById("table-selection");
            for (let i = 0; i < select.options.length; i++) {
                select.options[i].selected = false;
            }
            nextQuestion();
        }

        // Aloita peli
        generateQuestion();
    </script>
</body>
</html>
